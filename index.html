<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notre Rituel ‚ù§Ô∏è</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');
        body { font-family: 'Poppins', sans-serif; background: #fff0f3; text-align: center; padding: 20px; color: #444; margin: 0; overflow-x: hidden; }
        .card { background: white; max-width: 500px; margin: 20px auto; padding: 25px; border-radius: 30px; box-shadow: 0 10px 25px rgba(255,182,193,0.4); position: relative; z-index: 2; }
        
        /* Barre de progression */
        .progress-container { background: #eee; border-radius: 20px; margin: 15px 0; height: 20px; position: relative; overflow: hidden; border: 1px solid #ffd1d1; }
        .progress-bar { background: linear-gradient(90deg, #ff758c, #ff4d6d); height: 100%; width: 0%; transition: width 1s ease-in-out; }
        .progress-text { position: absolute; width: 100%; top: 50%; left: 0; transform: translateY(-50%); font-size: 0.7rem; font-weight: bold; }

        /* JOURNAL DES R√äVES */
        .dream-zone { background: #f0f4ff; padding: 20px; border-radius: 25px; margin-bottom: 20px; border: 2px solid #d0dbff; }
        .dream-zone h3 { margin-top: 0; font-size: 1rem; color: #5a7dff; }
        .dream-bubble { background: white; padding: 10px; border-radius: 15px; margin: 10px 0; font-size: 0.85rem; border-left: 4px solid #5a7dff; text-align: left; }

        /* Jeu des Bisous */
        .kiss-zone { background: #ffe5ec; padding: 15px; border-radius: 20px; margin-bottom: 20px; border: 2px dashed #ff4d6d; }
        #kiss-count { font-size: 1.2rem; font-weight: bold; color: #ff4d6d; display: block; margin-bottom: 5px; }
        .btn-small { background: #ff4d6d; color: white; border: none; padding: 8px 15px; border-radius: 50px; cursor: pointer; font-size: 0.8rem; }

        .question-block { background: #fff5f6; margin: 15px 0; padding: 20px; border-radius: 20px; border-left: 6px solid #ff4d6d; text-align: left; }
        textarea { width: 100%; border: 1px solid #ddd; border-radius: 12px; padding: 10px; box-sizing: border-box; margin-top: 5px; font-family: inherit; resize: none; }
        input { width: 100%; max-width: 300px; padding: 10px; border-radius: 15px; border: 1px solid #ddd; margin: 10px 0; text-align: center; }
        .main-btn { background: #ff4d6d; color: white; border: none; padding: 15px; border-radius: 50px; cursor: pointer; font-weight: bold; width: 100%; max-width: 300px; }
        
        .res { font-size: 0.85rem; margin-top: 10px; text-align: left; background: #fff; padding: 10px; border-radius: 15px; border: 1px solid #ffe5ec; }
        .heart { position: fixed; font-size: 25px; z-index: 1; pointer-events: none; animation: floatUp 3s linear forwards; top: 100%; }
        @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-100vh); opacity: 0; } }
    </style>
</head>
<body>

<div class="card">
    <h1>‚ú® Notre Rituel</h1>
    
    <div id="countdown-text" style="font-size: 0.8rem; font-weight: 600;">Calcul...</div>
    <div class="progress-container">
        <div id="myBar" class="progress-bar"></div>
        <div id="percent-text" class="progress-text">0%</div>
    </div>

    <div class="dream-zone">
        <h3>‚òÅÔ∏è Nos R√™ves de la nuit</h3>
        <div id="dream-list"></div>
        <textarea id="my-dream" placeholder="J'ai r√™v√© de..."></textarea>
        <button class="btn-small" style="background:#5a7dff;" onclick="partagerReve()">Partager mon r√™ve ‚ú®</button>
    </div>

    <div class="kiss-zone">
        <span id="kiss-count">üíã 0 bisous</span>
        <button class="btn-small" onclick="envoyerBisou()">Envoyer un bisou üíã</button>
    </div>

    <div id="questions-zone">Chargement...</div>
    
    <input type="text" id="mon-prenom" placeholder="Ton petit nom...">
    <button class="main-btn" onclick="envoyerReponse()">R√©pondre ‚ù§Ô∏è</button>
    
    <div id="reponses-flux" style="margin-top:20px;"></div>
</div>

<script>
    // --- 1. CONFIG FIREBASE ---
    const CONFIG = { databaseURL: "https://notre-petit-coin-default-rtdb.europe-west1.firebasedatabase.app" };
    firebase.initializeApp(CONFIG);
    const db = firebase.database();

    // --- 2. DATES ---
    const dateRetrouvailles = new Date("2026-03-12"); 
    const dateDepart = new Date("2026-01-15");        

    // --- 3. QUESTIONS ---
    const qMatin = ["Quelle est la premi√®re chose que tu ferais si tu te r√©veillais dans ma peau ?", "Si on √©tait dans un film d'horreur, qui mourrait en premier ?", "Si je devais me transformer en un objet de ta chambre, ce serait quoi ?", "Saveur de glace : classique ou bizarre ?", "La rumeur la plus dr√¥le sur notre couple ?", "Inventer une nouvelle f√™te ?", "Derni√®re b√™tise dont tu as eu envie ?", "Trait de caract√®re pr√©f√©r√© ?", "Couple de c√©l√©brit√©s ?"];
    const qSoir = ["Figer le temps sur quel moment ?", "Un 'bon pour...' ?", "Partie de ton corps que j'ai h√¢te que je touche ?", "Action ou V√©rit√© ?", "Acc√®s illimit√© 30min ?", "Li√© les mains : peur ou excitation ?", "D√©shabiller lentement ou arracher ?", "Lent ou sauvage ?"];

    // --- 4. LOGIQUE BARRE & QUESTIONS ---
    const maintenant = new Date();
    const indexJour = Math.floor(maintenant / (1000 * 60 * 60 * 24));
    const pourcent = Math.min(100, Math.max(0, Math.floor(((maintenant - dateDepart) / (dateRetrouvailles - dateDepart)) * 100)));
    const reste = Math.ceil((dateRetrouvailles - maintenant) / (1000 * 60 * 60 * 24));
    document.getElementById('myBar').style.width = pourcent + "%";
    document.getElementById('percent-text').innerText = pourcent + "%";
    document.getElementById('countdown-text').innerText = "Plus que " + reste + " jours ! üòç";

    const q1 = qMatin[indexJour % qMatin.length];
    const q2 = qSoir[indexJour % qSoir.length];
    let html = `<div class="question-block">‚òÄÔ∏è <b>Matin :</b><br>${q1}<textarea id="r1"></textarea></div>`;
    if (maintenant.getHours() >= 19 || maintenant.getHours() < 6) {
        html += `<div class="question-block" style="border-left-color:#7209b7">üåô <b>Soir :</b><br>${q2}<textarea id="r2"></textarea></div>`;
    } else {
        html += `<div class="question-block" style="opacity:0.5;">üåô Question du soir √† 19h...</div>`;
    }
    document.getElementById('questions-zone').innerHTML = html;

    // --- 5. JOURNAL DES R√äVES ---
    function partagerReve() {
        const nom = document.getElementById('mon-prenom').value;
        const reve = document.getElementById('my-dream').value;
        if(!nom || !reve) return alert("Nom + Ton r√™ve ! ‚ú®");
        db.ref('reves/' + indexJour).push({ auteur: nom, texte: reve });
        document.getElementById('my-dream').value = "";
    }

    db.ref('reves/' + indexJour).on('value', (snap) => {
        const data = snap.val();
        let listHtml = "";
        for(let id in data) {
            listHtml += `<div class="dream-bubble"><b>${data[id].auteur} :</b> ${data[id].texte}</div>`;
        }
        document.getElementById('dream-list').innerHTML = listHtml || "<p style='font-size:0.7rem;'>Aucun r√™ve partag√© ce matin...</p>";
    });

    // --- 6. BISOU & R√âPONSES ---
    function envoyerBisou() { db.ref('bisous').transaction(c => (c || 0) + 1); }
    db.ref('bisous').on('value', snap => {
        document.getElementById('kiss-count').innerText = `üíã ${snap.val() || 0} bisous`;
        const h = document.createElement('div'); h.classList.add('heart'); h.innerText = 'üíã';
        h.style.left = Math.random()*100+"vw"; document.body.appendChild(h);
        setTimeout(() => h.remove(), 3000);
    });

    function envoyerReponse() {
        const nom = document.getElementById('mon-prenom').value;
        const r1 = document.getElementById('r1') ? document.getElementById('r1').value : "";
        const r2 = document.getElementById('r2') ? document.getElementById('r2').value : "";
        if(!nom || (!r1 && !r2)) return alert("Nom + R√©ponse !");
        db.ref('reponses').push({ auteur: nom, matin: r1, soir: r2 });
        alert("Envoy√© ! ‚ù§Ô∏è"); location.reload();
    }

    db.ref('reponses').limitToLast(3).on('value', snap => {
        const data = snap.val(); let flux = "";
        for(let id in data) { flux = `<div class="res"><b>${data[id].auteur}</b> :<br>${data[id].matin ? '‚òÄÔ∏è '+data[id].matin : ''}<br>${data[id].soir ? 'üåô '+data[id].soir : ''}</div>` + flux; }
        document.getElementById('reponses-flux').innerHTML = flux;
    });
</script>
</body>
</html>
