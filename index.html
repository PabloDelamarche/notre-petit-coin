<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notre Rituel ‚ù§Ô∏è</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: sans-serif; background: #fff0f3; text-align: center; padding: 20px; color: #444; }
        .card { background: white; max-width: 500px; margin: auto; padding: 20px; border-radius: 25px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        
        /* Style de la barre de progression */
        .progress-container { background: #eee; border-radius: 20px; margin: 20px 0; height: 25px; position: relative; overflow: hidden; border: 1px solid #ffd1d1; }
        .progress-bar { background: linear-gradient(90deg, #ff758c, #ff4d6d); height: 100%; width: 0%; transition: width 1s ease-in-out; border-radius: 20px; }
        .progress-text { position: absolute; width: 100%; top: 50%; left: 0; transform: translateY(-50%); font-size: 0.8rem; font-weight: bold; color: #444; }

        .question-block { background: #fff5f6; margin: 15px 0; padding: 15px; border-radius: 15px; border-left: 5px solid #ff4d6d; text-align: left; }
        textarea { width: 100%; border: 1px solid #ddd; border-radius: 10px; padding: 10px; box-sizing: border-box; margin-top: 10px; font-family: inherit; }
        input { width: 80%; padding: 10px; margin: 15px 0; border-radius: 10px; border: 1px solid #ddd; text-align: center; }
        button { background: #ff4d6d; color: white; border: none; padding: 15px 30px; border-radius: 50px; cursor: pointer; font-weight: bold; width: 80%; }
        .res { font-size: 0.85rem; margin-top: 15px; text-align: left; background: #fefefe; padding: 10px; border-radius: 10px; border: 1px solid #eee; }
        .res b { color: #ff4d6d; }
    </style>
</head>
<body>

<div class="card">
    <h1>‚ú® Notre Rituel</h1>
    
    <div id="countdown-text" style="font-size: 0.9rem; margin-top: 10px;">Calcul des retrouvailles...</div>
    <div class="progress-container">
        <div id="myBar" class="progress-bar"></div>
        <div id="percent-text" class="progress-text">0%</div>
    </div>

    <div id="questions-zone">Chargement des questions...</div>
    
    <input type="text" id="mon-prenom" placeholder="Ton pr√©nom">
    <button onclick="envoyer()">Envoyer nos r√©ponses ‚ù§Ô∏è</button>
    
    <div id="reponses-flux" style="margin-top:20px;"></div>
</div>

<script>
    // --- 1. CONFIGURATION ---
    const CONFIG = {
        databaseURL: "https://notre-petit-coin-default-rtdb.europe-west1.firebasedatabase.app"
    };

    // --- 2. CONFIGURATION DES DATES ---
    const dateRetrouvailles = new Date("2026-03-12"); // DATE DE VOS RETROUVAILLES
    const dateDepart = new Date("2026-01-31");        // DATE DE VOTRE D√âPART

    // --- 3. QUESTIONS (LISTES COMPL√àTES) ---
    const qMatin = [
        "C‚Äôest quoi ton moment pr√©f√©r√© la derni√®re fois qu‚Äôon s‚Äôest vu ?", "Quelle est la petite chose que je fais et qui te fait craquer ?", "Quel est le plus beau compliment que je t‚Äôai fait ?", "Je ressemble √† quoi comme cr√©ature moche, faut d√©velopper sinon √ßa va goumer ;)", "Quelle est ma manie la plus bizarre que tu as d√©couverte ?", "Si on √©tait des animaux, on serait quoi ?", "Est-ce que y‚Äôa un message que je t‚Äôai envoy√© o√π tu t‚Äôes dit ¬´ aah c‚Äôest pas le couteau le plus aiguis√© ¬ª", "Si je devais devenir une star, je serais c√©l√®bre pour quoi ?", "Si je t‚Äôenvoie un message j‚Äôai merd√©, tu penses ce serait sur quoi", "Si je finis en prison ce serait pour quel motif", "Quel est mon plus gros d√©faut", "Donne 3 mots pour d√©crire notre relation"
    ];
    const qSoir = [
        "Si tu ne devais garder qu‚Äôun souvenir de moi ce serait lequel ?", "Si on √©tait ensemble l√† tout de suite, on ferait quoi ?", "Quelle est la photo de nous deux que tu aimerais faire ?", "Qu‚Äôest-ce qui te manque le plus le soir ?", "Quel est ton souvenir le plus doux sous la couette ?", "Quelle est la blessure du pass√© que j'ai r√©ussi √† apaiser ? maybe t‚Äôes parfaite", "C'est quoi le truc le plus bizarre qui t'excite un peu ?", "Si on devait vivre nus dans une for√™t, qui craquerait en premier ?", "Quelle est la recherche la plus √©trange que tu as faite sur Google r√©cemment ?", "C'est quoi le secret que tu ne m'as pas dit par peur que je te trouve bizarre ?", "Quelle est la pire chose que tu aies faite par jalousie ?", "Si je devais te surprendre ce soir, je devrais faire quoi"
    ];

    // --- 4. LOGIQUE BARRE DE PROGRESSION & QUESTIONS ---
    const maintenant = new Date();
    const heure = maintenant.getHours();
    const jourDuMois = maintenant.getDate();

    // Calcul Barre
    const totalDuree = dateRetrouvailles - dateDepart;
    const ecoule = maintenant - dateDepart;
    let pourcent = Math.floor((ecoule / totalDuree) * 100);
    if(pourcent > 100) pourcent = 100;
    if(pourcent < 0) pourcent = 0;

    const joursRestants = Math.ceil((dateRetrouvailles - maintenant) / (1000 * 60 * 60 * 24));

    // Mise √† jour visuelle imm√©diate
    document.getElementById('myBar').style.width = pourcent + "%";
    document.getElementById('percent-text').innerText = pourcent + "%";
    document.getElementById('countdown-text').innerText = "Plus que " + joursRestants + " jours avant de se voir ! üòç";

    // Affichage Questions
    const quest1 = qMatin[jourDuMois % qMatin.length];
    const quest2 = qSoir[jourDuMois % qSoir.length];
    let html = `<div class="question-block">‚òÄÔ∏è <b>Matin :</b><br>${quest1}<textarea id="r1"></textarea></div>`;

    if (heure >= 19 || heure < 6) {
        html += `<div class="question-block" style="border-left-color:purple;">üåô <b>Soir :</b><br>${quest2}<textarea id="r2"></textarea></div>`;
    } else {
        html += `<div class="question-block" style="opacity:0.5;">üåô Question du soir √† 19h...</div>`;
    }
    document.getElementById('questions-zone').innerHTML = html;

    // --- 5. FIREBASE ---
    let db;
    try {
        firebase.initializeApp(CONFIG);
        db = firebase.database();
        db.ref('reponses').limitToLast(5).on('value', (snap) => {
            const data = snap.val();
            let flux = "";
            for (let id in data) {
                flux = `<div class="res"><b>${data[id].nom}</b> : ${data[id].msg1} ${data[id].msg2}</div>` + flux;
            }
            document.getElementById('reponses-flux').innerHTML = flux;
        });
    } catch(e) { console.log("Erreur Firebase"); }

    function envoyer() {
        const nom = document.getElementById('mon-prenom').value;
        if(!nom) return alert("Ton pr√©nom !");
        const m1 = document.getElementById('r1') ? document.getElementById('r1').value : "";
        const m2 = document.getElementById('r2') ? document.getElementById('r2').value : "";

        db.ref('reponses').push({
            nom: nom,
            msg1: m1 ? "‚òÄÔ∏è "+m1 : "",
            msg2: m2 ? "üåô "+m2 : ""
        });
        alert("Envoy√© ! ‚ù§Ô∏è");
        if(document.getElementById('r1')) document.getElementById('r1').value = "";
        if(document.getElementById('r2')) document.getElementById('r2').value = "";
    }
</script>
</body>
</html>
